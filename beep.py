#!/usr/bin/python
import sys
import serial

class SID:
	def __init__(self):

		self.s = serial.Serial()
		self.s.port = "/dev/ttyUSB0"
		self.s.baudrate = 230400 / 2
		self.s.open()

	def close(self):
		self.s.close()


	def write(self, reg, value):
		assert(0 <= reg < 25)
		assert(0 <= value < 256)
		self.s.write("%c%c" % (reg, value))

	def read(self):
		return self.s.read()



def test():
	sounds = [
		[
			0x00, 0x80, 0x00, 0x00, 0x21, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x0f
		],
		[
			0x00, 0x80, 0x00, 0x00, 0x20, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x0f
		],



		[
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x80, 0x00, 0x00, 0x21, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x0f
		],
		[
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x80, 0x00, 0x00, 0x20, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x0f
		],



		[
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x80, 0x00, 0x00, 0x21, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x0f
		],
		[
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x80, 0x00, 0x00, 0x20, 0x17, 0x79,
			0x00, 0x00, 0x00, 0x0f
		]
	]

	sid = SID()
	while 1:
		for sound in sounds:
			for i, v in enumerate(sound): sid.write(i, v)
			sid.s.write("\xf7")
			raw_input()


if __name__ == "__main__": test()


